<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WebFrame++: coroute::CompressionMiddleware Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">WebFrame++<span id="projectnumber">&#160;v2.0.0</span>
   </div>
   <div id="projectbrief">Modern C++20 Coroutine-based Web Framework with HTTP/2, TLS, and WebSocket support</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../de/d6f/namespacecoroute.html">coroute</a></li><li class="navelem"><a class="el" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html">CompressionMiddleware</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-static-methods">Static Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a>  </div>
  <div class="headertitle"><div class="title">coroute::CompressionMiddleware Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../d7/deb/compression_8hpp_source.html">compression.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a611e81f1ae2d928d77ab04754cde159c" id="r_a611e81f1ae2d928d77ab04754cde159c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#a611e81f1ae2d928d77ab04754cde159c">CompressionMiddleware</a> (<a class="el" href="../../da/dff/structcoroute_1_1_compression_options.html">CompressionOptions</a> <a class="el" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#ae8a19d33a52caa748a73af3a17320390">options</a>={})</td></tr>
<tr class="separator:a611e81f1ae2d928d77ab04754cde159c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a597a5a1cee99deae71211af27b6f72bd" id="r_a597a5a1cee99deae71211af27b6f72bd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/d44/classcoroute_1_1_task.html">Task</a>&lt; <a class="el" href="../../d3/df8/classcoroute_1_1_response.html">Response</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#a597a5a1cee99deae71211af27b6f72bd">operator()</a> (<a class="el" href="../../d7/dd1/classcoroute_1_1_request.html">Request</a> &amp;<a class="el" href="../../df/d44/classcoroute_1_1_task.html">req</a>, <a class="el" href="../../de/d6f/namespacecoroute.html#a9e5bc2d098a922953cf99888180be209">Next</a> <a class="el" href="../../df/d44/classcoroute_1_1_task.html">next</a>)</td></tr>
<tr class="separator:a597a5a1cee99deae71211af27b6f72bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a401866851c702cc74b29e6a639a860df" id="r_a401866851c702cc74b29e6a639a860df"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/d44/classcoroute_1_1_task.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#a401866851c702cc74b29e6a639a860df">should_compress</a> (std::string_view content_type) <a class="el" href="../../df/d44/classcoroute_1_1_task.html">const</a></td></tr>
<tr class="separator:a401866851c702cc74b29e6a639a860df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8a19d33a52caa748a73af3a17320390" id="r_ae8a19d33a52caa748a73af3a17320390"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/d44/classcoroute_1_1_task.html">const</a> <a class="el" href="../../da/dff/structcoroute_1_1_compression_options.html">CompressionOptions</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#ae8a19d33a52caa748a73af3a17320390">options</a> () <a class="el" href="../../df/d44/classcoroute_1_1_task.html">const</a> <a class="el" href="../../df/d44/classcoroute_1_1_task.html">noexcept</a></td></tr>
<tr class="separator:ae8a19d33a52caa748a73af3a17320390"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-static-methods" name="pri-static-methods"></a>
Static Private Member Functions</h2></td></tr>
<tr class="memitem:ab8ef89d56944a7503cc91a474d183fc5" id="r_ab8ef89d56944a7503cc91a474d183fc5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../df/d44/classcoroute_1_1_task.html">static</a> <a class="el" href="../../df/d44/classcoroute_1_1_task.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#ab8ef89d56944a7503cc91a474d183fc5">content_type_matches</a> (std::string_view type, std::string_view pattern)</td></tr>
<tr class="separator:ab8ef89d56944a7503cc91a474d183fc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a46339ca3cebc3d8a91a885a2c3efed0e" id="r_a46339ca3cebc3d8a91a885a2c3efed0e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../da/dff/structcoroute_1_1_compression_options.html">CompressionOptions</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#a46339ca3cebc3d8a91a885a2c3efed0e">options_</a></td></tr>
<tr class="separator:a46339ca3cebc3d8a91a885a2c3efed0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="../../d7/deb/compression_8hpp_source.html#l00125">125</a> of file <a class="el" href="../../d7/deb/compression_8hpp_source.html">compression.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a611e81f1ae2d928d77ab04754cde159c" name="a611e81f1ae2d928d77ab04754cde159c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a611e81f1ae2d928d77ab04754cde159c">&#9670;&#160;</a></span>CompressionMiddleware()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">coroute::CompressionMiddleware::CompressionMiddleware </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../da/dff/structcoroute_1_1_compression_options.html">CompressionOptions</a>&#160;</td>
          <td class="paramname"><em>options</em> = <code>{}</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/dc6/compression_8cpp_source.html#l00422">422</a> of file <a class="el" href="../../de/dc6/compression_8cpp_source.html">compression.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  423</span>    : <a class="code hl_variable" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#a46339ca3cebc3d8a91a885a2c3efed0e">options_</a>(std::move(<a class="code hl_function" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#ae8a19d33a52caa748a73af3a17320390">options</a>))</div>
<div class="line"><span class="lineno">  424</span>{</div>
<div class="line"><span class="lineno">  425</span>    <span class="comment">// Remove Brotli from enabled if not available</span></div>
<div class="line"><span class="lineno">  426</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="../../d1/d59/namespacecoroute_1_1compress.html#a58d34ada3a22af5af400352f9dd6485c">compress::brotli_available</a>()) {</div>
<div class="line"><span class="lineno">  427</span>        <a class="code hl_variable" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#a46339ca3cebc3d8a91a885a2c3efed0e">options_</a>.<a class="code hl_variable" href="../../da/dff/structcoroute_1_1_compression_options.html#a3ebe9a715bf4b98210b0564cb9f79b78">algorithms</a>.erase(<a class="code hl_enumvalue" href="../../de/d6f/namespacecoroute.html#ac16409f02db3f2c2f94d178d045dcbeda4b9159701faed6a94df888e2c83b48bf">CompressionAlgorithm::Brotli</a>);</div>
<div class="line"><span class="lineno">  428</span>    }</div>
<div class="line"><span class="lineno">  429</span>}</div>
<div class="ttc" id="aclasscoroute_1_1_compression_middleware_html_a46339ca3cebc3d8a91a885a2c3efed0e"><div class="ttname"><a href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#a46339ca3cebc3d8a91a885a2c3efed0e">coroute::CompressionMiddleware::options_</a></div><div class="ttdeci">CompressionOptions options_</div><div class="ttdef"><b>Definition</b> <a href="../../d7/deb/compression_8hpp_source.html#l00139">compression.hpp:139</a></div></div>
<div class="ttc" id="aclasscoroute_1_1_compression_middleware_html_ae8a19d33a52caa748a73af3a17320390"><div class="ttname"><a href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#ae8a19d33a52caa748a73af3a17320390">coroute::CompressionMiddleware::options</a></div><div class="ttdeci">const CompressionOptions &amp; options() const noexcept</div><div class="ttdef"><b>Definition</b> <a href="../../d7/deb/compression_8hpp_source.html#l00136">compression.hpp:136</a></div></div>
<div class="ttc" id="anamespacecoroute_1_1compress_html_a58d34ada3a22af5af400352f9dd6485c"><div class="ttname"><a href="../../d1/d59/namespacecoroute_1_1compress.html#a58d34ada3a22af5af400352f9dd6485c">coroute::compress::brotli_available</a></div><div class="ttdeci">bool brotli_available() noexcept</div><div class="ttdef"><b>Definition</b> <a href="../../de/dc6/compression_8cpp_source.html#l00165">compression.cpp:165</a></div></div>
<div class="ttc" id="anamespacecoroute_html_ac16409f02db3f2c2f94d178d045dcbeda4b9159701faed6a94df888e2c83b48bf"><div class="ttname"><a href="../../de/d6f/namespacecoroute.html#ac16409f02db3f2c2f94d178d045dcbeda4b9159701faed6a94df888e2c83b48bf">coroute::CompressionAlgorithm::Brotli</a></div><div class="ttdeci">@ Brotli</div></div>
<div class="ttc" id="astructcoroute_1_1_compression_options_html_a3ebe9a715bf4b98210b0564cb9f79b78"><div class="ttname"><a href="../../da/dff/structcoroute_1_1_compression_options.html#a3ebe9a715bf4b98210b0564cb9f79b78">coroute::CompressionOptions::algorithms</a></div><div class="ttdeci">std::set&lt; CompressionAlgorithm &gt; algorithms</div><div class="ttdef"><b>Definition</b> <a href="../../d7/deb/compression_8hpp_source.html#l00045">compression.hpp:45</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ab8ef89d56944a7503cc91a474d183fc5" name="ab8ef89d56944a7503cc91a474d183fc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8ef89d56944a7503cc91a474d183fc5">&#9670;&#160;</a></span>content_type_matches()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/d44/classcoroute_1_1_task.html">bool</a> coroute::CompressionMiddleware::content_type_matches </td>
          <td>(</td>
          <td class="paramtype">std::string_view&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string_view&#160;</td>
          <td class="paramname"><em>pattern</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/dc6/compression_8cpp_source.html#l00431">431</a> of file <a class="el" href="../../de/dc6/compression_8cpp_source.html">compression.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  431</span>                                                                                            {</div>
<div class="line"><span class="lineno">  432</span>    <span class="comment">// Extract just the media type (ignore charset, etc.)</span></div>
<div class="line"><span class="lineno">  433</span>    <span class="keyword">auto</span> semicolon = type.find(<span class="charliteral">&#39;;&#39;</span>);</div>
<div class="line"><span class="lineno">  434</span>    <span class="keywordflow">if</span> (semicolon != std::string_view::npos) {</div>
<div class="line"><span class="lineno">  435</span>        type = type.substr(0, semicolon);</div>
<div class="line"><span class="lineno">  436</span>    }</div>
<div class="line"><span class="lineno">  437</span>    type = trim(type);</div>
<div class="line"><span class="lineno">  438</span>    </div>
<div class="line"><span class="lineno">  439</span>    <span class="comment">// Check for wildcard</span></div>
<div class="line"><span class="lineno">  440</span>    <span class="keywordflow">if</span> (pattern.ends_with(<span class="stringliteral">&quot;/*&quot;</span>)) {</div>
<div class="line"><span class="lineno">  441</span>        <span class="keyword">auto</span> prefix = pattern.substr(0, pattern.size() - 1);  <span class="comment">// &quot;text/&quot;</span></div>
<div class="line"><span class="lineno">  442</span>        <span class="keywordflow">return</span> type.substr(0, prefix.size()) == prefix;</div>
<div class="line"><span class="lineno">  443</span>    }</div>
<div class="line"><span class="lineno">  444</span>    </div>
<div class="line"><span class="lineno">  445</span>    <span class="comment">// Exact match (case-insensitive)</span></div>
<div class="line"><span class="lineno">  446</span>    <span class="keywordflow">return</span> to_lower(type) == to_lower(pattern);</div>
<div class="line"><span class="lineno">  447</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a597a5a1cee99deae71211af27b6f72bd" name="a597a5a1cee99deae71211af27b6f72bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a597a5a1cee99deae71211af27b6f72bd">&#9670;&#160;</a></span>operator()()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/d44/classcoroute_1_1_task.html">Task</a>&lt; <a class="el" href="../../d3/df8/classcoroute_1_1_response.html">Response</a> &gt; coroute::CompressionMiddleware::operator() </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d7/dd1/classcoroute_1_1_request.html">Request</a> &amp;&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/d6f/namespacecoroute.html#a9e5bc2d098a922953cf99888180be209">Next</a>&#160;</td>
          <td class="paramname"><em>next</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/dc6/compression_8cpp_source.html#l00458">458</a> of file <a class="el" href="../../de/dc6/compression_8cpp_source.html">compression.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  458</span>                                                                        {</div>
<div class="line"><span class="lineno">  459</span>    <span class="comment">// Get response from next handler</span></div>
<div class="line"><span class="lineno">  460</span>    Response resp = <span class="keyword">co_await</span> next(req);</div>
<div class="line"><span class="lineno">  461</span>    </div>
<div class="line"><span class="lineno">  462</span>    <span class="comment">// Skip if response already has Content-Encoding</span></div>
<div class="line"><span class="lineno">  463</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#a46339ca3cebc3d8a91a885a2c3efed0e">options_</a>.<a class="code hl_variable" href="../../da/dff/structcoroute_1_1_compression_options.html#afd966da4f29cb3b368aba4af811d30e2">skip_if_encoded</a>) {</div>
<div class="line"><span class="lineno">  464</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; [key, value] : resp.headers()) {</div>
<div class="line"><span class="lineno">  465</span>            <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;Content-Encoding&quot;</span>) {</div>
<div class="line"><span class="lineno">  466</span>                <span class="keyword">co_return</span> resp;</div>
<div class="line"><span class="lineno">  467</span>            }</div>
<div class="line"><span class="lineno">  468</span>        }</div>
<div class="line"><span class="lineno">  469</span>    }</div>
<div class="line"><span class="lineno">  470</span>    </div>
<div class="line"><span class="lineno">  471</span>    <span class="comment">// Check body size</span></div>
<div class="line"><span class="lineno">  472</span>    <span class="keywordflow">if</span> (resp.body().size() &lt; <a class="code hl_variable" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#a46339ca3cebc3d8a91a885a2c3efed0e">options_</a>.<a class="code hl_variable" href="../../da/dff/structcoroute_1_1_compression_options.html#a775f6aa17e56834d08f2209d97b0e33c">min_size</a>) {</div>
<div class="line"><span class="lineno">  473</span>        <span class="keyword">co_return</span> resp;</div>
<div class="line"><span class="lineno">  474</span>    }</div>
<div class="line"><span class="lineno">  475</span>    </div>
<div class="line"><span class="lineno">  476</span>    <span class="comment">// Check content type</span></div>
<div class="line"><span class="lineno">  477</span>    std::string_view content_type;</div>
<div class="line"><span class="lineno">  478</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; [key, value] : resp.headers()) {</div>
<div class="line"><span class="lineno">  479</span>        <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;Content-Type&quot;</span>) {</div>
<div class="line"><span class="lineno">  480</span>            content_type = value;</div>
<div class="line"><span class="lineno">  481</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  482</span>        }</div>
<div class="line"><span class="lineno">  483</span>    }</div>
<div class="line"><span class="lineno">  484</span>    </div>
<div class="line"><span class="lineno">  485</span>    <span class="keywordflow">if</span> (content_type.empty() || !<a class="code hl_function" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#a401866851c702cc74b29e6a639a860df">should_compress</a>(content_type)) {</div>
<div class="line"><span class="lineno">  486</span>        <span class="keyword">co_return</span> resp;</div>
<div class="line"><span class="lineno">  487</span>    }</div>
<div class="line"><span class="lineno">  488</span>    </div>
<div class="line"><span class="lineno">  489</span>    <span class="comment">// Parse Accept-Encoding</span></div>
<div class="line"><span class="lineno">  490</span>    <span class="keyword">auto</span> accept_encoding = req.header(<span class="stringliteral">&quot;Accept-Encoding&quot;</span>);</div>
<div class="line"><span class="lineno">  491</span>    <span class="keywordflow">if</span> (!accept_encoding) {</div>
<div class="line"><span class="lineno">  492</span>        <span class="keyword">co_return</span> resp;</div>
<div class="line"><span class="lineno">  493</span>    }</div>
<div class="line"><span class="lineno">  494</span>    </div>
<div class="line"><span class="lineno">  495</span>    <span class="keyword">auto</span> algo = <a class="code hl_function" href="../../de/d6f/namespacecoroute.html#ab57e9f4905165e24922b7c2ac7817faa">parse_accept_encoding</a>(*accept_encoding, <a class="code hl_variable" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#a46339ca3cebc3d8a91a885a2c3efed0e">options_</a>.<a class="code hl_variable" href="../../da/dff/structcoroute_1_1_compression_options.html#a3ebe9a715bf4b98210b0564cb9f79b78">algorithms</a>);</div>
<div class="line"><span class="lineno">  496</span>    <span class="keywordflow">if</span> (algo == <a class="code hl_enumvalue" href="../../de/d6f/namespacecoroute.html#ac16409f02db3f2c2f94d178d045dcbedac9c5c65fb4af9cf90eb99b3b84424189">CompressionAlgorithm::Identity</a>) {</div>
<div class="line"><span class="lineno">  497</span>        <span class="keyword">co_return</span> resp;</div>
<div class="line"><span class="lineno">  498</span>    }</div>
<div class="line"><span class="lineno">  499</span>    </div>
<div class="line"><span class="lineno">  500</span>    <span class="comment">// Compress</span></div>
<div class="line"><span class="lineno">  501</span>    <span class="keyword">auto</span> compressed = <a class="code hl_function" href="../../d1/d59/namespacecoroute_1_1compress.html#afddee3a54be58dc311d70bd1317b1bc8">compress::compress</a>(resp.body(), algo, <a class="code hl_variable" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#a46339ca3cebc3d8a91a885a2c3efed0e">options_</a>.<a class="code hl_variable" href="../../da/dff/structcoroute_1_1_compression_options.html#aa65b5282d2edc02859cf6e816fa10f1e">level</a>);</div>
<div class="line"><span class="lineno">  502</span>    <span class="keywordflow">if</span> (!compressed || compressed-&gt;size() &gt;= resp.body().size()) {</div>
<div class="line"><span class="lineno">  503</span>        <span class="comment">// Compression failed or didn&#39;t help</span></div>
<div class="line"><span class="lineno">  504</span>        <span class="keyword">co_return</span> resp;</div>
<div class="line"><span class="lineno">  505</span>    }</div>
<div class="line"><span class="lineno">  506</span>    </div>
<div class="line"><span class="lineno">  507</span>    <span class="comment">// Update response</span></div>
<div class="line"><span class="lineno">  508</span>    resp.set_body(std::move(*compressed));</div>
<div class="line"><span class="lineno">  509</span>    resp.set_header(<span class="stringliteral">&quot;Content-Encoding&quot;</span>, std::string(<a class="code hl_function" href="../../de/d6f/namespacecoroute.html#a7a38a945664e4d3e5be7dededabc3555">algorithm_name</a>(algo)));</div>
<div class="line"><span class="lineno">  510</span>    resp.set_header(<span class="stringliteral">&quot;Content-Length&quot;</span>, std::to_string(resp.body().size()));</div>
<div class="line"><span class="lineno">  511</span>    </div>
<div class="line"><span class="lineno">  512</span>    <span class="comment">// Add Vary header</span></div>
<div class="line"><span class="lineno">  513</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#a46339ca3cebc3d8a91a885a2c3efed0e">options_</a>.<a class="code hl_variable" href="../../da/dff/structcoroute_1_1_compression_options.html#a7477d7df9ec11b42c1d83b2b7474ccbe">add_vary_header</a>) {</div>
<div class="line"><span class="lineno">  514</span>        resp.set_header(<span class="stringliteral">&quot;Vary&quot;</span>, <span class="stringliteral">&quot;Accept-Encoding&quot;</span>);</div>
<div class="line"><span class="lineno">  515</span>    }</div>
<div class="line"><span class="lineno">  516</span>    </div>
<div class="line"><span class="lineno">  517</span>    <span class="keyword">co_return</span> resp;</div>
<div class="line"><span class="lineno">  518</span>}</div>
<div class="ttc" id="aclasscoroute_1_1_compression_middleware_html_a401866851c702cc74b29e6a639a860df"><div class="ttname"><a href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#a401866851c702cc74b29e6a639a860df">coroute::CompressionMiddleware::should_compress</a></div><div class="ttdeci">bool should_compress(std::string_view content_type) const</div><div class="ttdef"><b>Definition</b> <a href="../../de/dc6/compression_8cpp_source.html#l00449">compression.cpp:449</a></div></div>
<div class="ttc" id="anamespacecoroute_1_1compress_html_afddee3a54be58dc311d70bd1317b1bc8"><div class="ttname"><a href="../../d1/d59/namespacecoroute_1_1compress.html#afddee3a54be58dc311d70bd1317b1bc8">coroute::compress::compress</a></div><div class="ttdeci">std::optional&lt; std::string &gt; compress(std::string_view data, CompressionAlgorithm algo, int level=6)</div><div class="ttdef"><b>Definition</b> <a href="../../de/dc6/compression_8cpp_source.html#l00284">compression.cpp:284</a></div></div>
<div class="ttc" id="anamespacecoroute_html_a7a38a945664e4d3e5be7dededabc3555"><div class="ttname"><a href="../../de/d6f/namespacecoroute.html#a7a38a945664e4d3e5be7dededabc3555">coroute::algorithm_name</a></div><div class="ttdeci">std::string_view algorithm_name(CompressionAlgorithm algo) noexcept</div><div class="ttdef"><b>Definition</b> <a href="../../de/dc6/compression_8cpp_source.html#l00023">compression.cpp:23</a></div></div>
<div class="ttc" id="anamespacecoroute_html_ab57e9f4905165e24922b7c2ac7817faa"><div class="ttname"><a href="../../de/d6f/namespacecoroute.html#ab57e9f4905165e24922b7c2ac7817faa">coroute::parse_accept_encoding</a></div><div class="ttdeci">CompressionAlgorithm parse_accept_encoding(std::string_view header, const std::set&lt; CompressionAlgorithm &gt; &amp;enabled)</div><div class="ttdef"><b>Definition</b> <a href="../../de/dc6/compression_8cpp_source.html#l00091">compression.cpp:91</a></div></div>
<div class="ttc" id="anamespacecoroute_html_ac16409f02db3f2c2f94d178d045dcbedac9c5c65fb4af9cf90eb99b3b84424189"><div class="ttname"><a href="../../de/d6f/namespacecoroute.html#ac16409f02db3f2c2f94d178d045dcbedac9c5c65fb4af9cf90eb99b3b84424189">coroute::CompressionAlgorithm::Identity</a></div><div class="ttdeci">@ Identity</div></div>
<div class="ttc" id="astructcoroute_1_1_compression_options_html_a7477d7df9ec11b42c1d83b2b7474ccbe"><div class="ttname"><a href="../../da/dff/structcoroute_1_1_compression_options.html#a7477d7df9ec11b42c1d83b2b7474ccbe">coroute::CompressionOptions::add_vary_header</a></div><div class="ttdeci">bool add_vary_header</div><div class="ttdef"><b>Definition</b> <a href="../../d7/deb/compression_8hpp_source.html#l00082">compression.hpp:82</a></div></div>
<div class="ttc" id="astructcoroute_1_1_compression_options_html_a775f6aa17e56834d08f2209d97b0e33c"><div class="ttname"><a href="../../da/dff/structcoroute_1_1_compression_options.html#a775f6aa17e56834d08f2209d97b0e33c">coroute::CompressionOptions::min_size</a></div><div class="ttdeci">size_t min_size</div><div class="ttdef"><b>Definition</b> <a href="../../d7/deb/compression_8hpp_source.html#l00053">compression.hpp:53</a></div></div>
<div class="ttc" id="astructcoroute_1_1_compression_options_html_aa65b5282d2edc02859cf6e816fa10f1e"><div class="ttname"><a href="../../da/dff/structcoroute_1_1_compression_options.html#aa65b5282d2edc02859cf6e816fa10f1e">coroute::CompressionOptions::level</a></div><div class="ttdeci">int level</div><div class="ttdef"><b>Definition</b> <a href="../../d7/deb/compression_8hpp_source.html#l00057">compression.hpp:57</a></div></div>
<div class="ttc" id="astructcoroute_1_1_compression_options_html_afd966da4f29cb3b368aba4af811d30e2"><div class="ttname"><a href="../../da/dff/structcoroute_1_1_compression_options.html#afd966da4f29cb3b368aba4af811d30e2">coroute::CompressionOptions::skip_if_encoded</a></div><div class="ttdeci">bool skip_if_encoded</div><div class="ttdef"><b>Definition</b> <a href="../../d7/deb/compression_8hpp_source.html#l00079">compression.hpp:79</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae8a19d33a52caa748a73af3a17320390" name="ae8a19d33a52caa748a73af3a17320390"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8a19d33a52caa748a73af3a17320390">&#9670;&#160;</a></span>options()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/d44/classcoroute_1_1_task.html">const</a> <a class="el" href="../../da/dff/structcoroute_1_1_compression_options.html">CompressionOptions</a> &amp; coroute::CompressionMiddleware::options </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d7/deb/compression_8hpp_source.html#l00136">136</a> of file <a class="el" href="../../d7/deb/compression_8hpp_source.html">compression.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  136</span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#a46339ca3cebc3d8a91a885a2c3efed0e">options_</a>; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a401866851c702cc74b29e6a639a860df" name="a401866851c702cc74b29e6a639a860df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a401866851c702cc74b29e6a639a860df">&#9670;&#160;</a></span>should_compress()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/d44/classcoroute_1_1_task.html">bool</a> coroute::CompressionMiddleware::should_compress </td>
          <td>(</td>
          <td class="paramtype">std::string_view&#160;</td>
          <td class="paramname"><em>content_type</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/dc6/compression_8cpp_source.html#l00449">449</a> of file <a class="el" href="../../de/dc6/compression_8cpp_source.html">compression.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  449</span>                                                                             {</div>
<div class="line"><span class="lineno">  450</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pattern : <a class="code hl_variable" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#a46339ca3cebc3d8a91a885a2c3efed0e">options_</a>.compressible_types) {</div>
<div class="line"><span class="lineno">  451</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#ab8ef89d56944a7503cc91a474d183fc5">content_type_matches</a>(content_type, pattern)) {</div>
<div class="line"><span class="lineno">  452</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  453</span>        }</div>
<div class="line"><span class="lineno">  454</span>    }</div>
<div class="line"><span class="lineno">  455</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  456</span>}</div>
<div class="ttc" id="aclasscoroute_1_1_compression_middleware_html_ab8ef89d56944a7503cc91a474d183fc5"><div class="ttname"><a href="../../d7/d3d/classcoroute_1_1_compression_middleware.html#ab8ef89d56944a7503cc91a474d183fc5">coroute::CompressionMiddleware::content_type_matches</a></div><div class="ttdeci">static bool content_type_matches(std::string_view type, std::string_view pattern)</div><div class="ttdef"><b>Definition</b> <a href="../../de/dc6/compression_8cpp_source.html#l00431">compression.cpp:431</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Field Documentation</h2>
<a id="a46339ca3cebc3d8a91a885a2c3efed0e" name="a46339ca3cebc3d8a91a885a2c3efed0e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46339ca3cebc3d8a91a885a2c3efed0e">&#9670;&#160;</a></span>options_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../da/dff/structcoroute_1_1_compression_options.html">CompressionOptions</a> coroute::CompressionMiddleware::options_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d7/deb/compression_8hpp_source.html#l00139">139</a> of file <a class="el" href="../../d7/deb/compression_8hpp_source.html">compression.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/coroute/core/<a class="el" href="../../d7/deb/compression_8hpp_source.html">compression.hpp</a></li>
<li>src/core/<a class="el" href="../../de/dc6/compression_8cpp_source.html">compression.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
